version: '3'

vars:
  WITH_CUDA: '{{.WITH_CUDA| default false}}'

tasks:
  venv:create:
    desc: Create a python virtual environment
    cmds:
      - cmd: py -m venv .venv
    status:
      - test -f .venv/Scripts/activate

  venv:
    desc: Start the virtual environment
    deps: [venv:create]
    cmd: cd .venv/Scripts && activate
    interactive: true


  install-deps:
    desc: Install Python dependencies
    deps: [venv:create]
    cmds:
      - cmd: 'cd .venv/Scripts && activate && cd ../../ && pip install -r tensorflow-{{if eq .WITH_CUDA "true"}}{{"gpu"}}{{else}}{{"cpu"}}{{end}}-requirements.txt'

  notebook:
    desc: Start Jupyter Notebook server
    cmds:
      - jupyter notebook

  lint:
    desc: Run code linting
    cmds:
      - flake8 .

  test:
    desc: Run tests
    cmds:
      - pytest

  clean:
    desc: Clean temporary files
    cmds:
      - rm -rf __pycache__ .pytest_cache .ipynb_checkpoints

  setup:
    desc: Setup environment
    cmds:
      - cmd: py -m venv .venv
      - task: install-dependencies